"use strict";(self["webpackChunkmoric_app"]=self["webpackChunkmoric_app"]||[]).push([[445],{3044:function(e,t,s){s.d(t,{i:function(){return n}});s(2801),s(1439),s(7585),s(5315),s(2062);var a=s(1020),i=s(56);const n=(0,a.Q_)("imgCounter",{state(){return{imageList:new Map}},actions:{async requestImage(e,t){return this.imageList.has(e)?this.getPicture(e):new Promise(((s,a)=>{(0,i.Z)({url:"/moric/avatar",method:"post",data:{user_id:e}}).then((a=>{a.data.body&&(this.savePicture(a.data.body,e,t),s(this.getPicture(e)))})).catch((e=>{console.log(e),a("失败")}))}))},savePicture(e,t,s){let a=null;if(/^data:.*;base64,/.test(e)){const t=atob(e.split(",")[1]),i=new Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);a=new Blob([new Uint8Array(i)],{type:`image/${s}`})}else a=new Blob([e],{type:`image/${s}`});this.imageList.set(t,a)},getPicture(e){let t=null;return this.imageList.get(e)&&(t=window.URL.createObjectURL(this.imageList.get(e))),t},clearImages(){for(const[e,t]of imageList.entries())URL.revokeObjectURL(t),this.imageList.delete(e)}}})},2176:function(e,t,s){s.d(t,{Z:function(){return b}});var a=s(3396),i=s(9242),n=s(7139);const r={class:"topNavigation"},o={class:"topLeft"},c=(0,a._)("div",{class:"blackIcon"},"",-1),l=[c],u={class:"stateMsg"},g=(0,a._)("div",{class:"appLogo"},[(0,a._)("div",{class:"appIcon"},"Moric")],-1);function m(e,t,s,c,m,d){return(0,a.wg)(),(0,a.iD)("div",r,[(0,a._)("div",o,[(0,a._)("a",{onClick:t[0]||(t[0]=(0,i.iM)(((...e)=>c.goTo&&c.goTo(...e)),["stop"])),class:"black"},l),(0,a._)("div",u,(0,n.zw)(s.name),1)]),g])}var d=s(2483),v=s(3017),p=s.n(v),h=s(4239),_=s(1917),M={name:"MoricAppNavation",props:["name","msg"],setup(e){const t=(0,d.tv)(),s=(0,_.z)();function a(){const a=(0,h.A)();a.clearUserList(),a.$reset(),s.$reset(),p().publish("clearUserList"),p().publish("scoketDisconnect"),t.replace({name:e.msg.name,path:e.msg.path})}return{goTo:a}}},f=s(89);const w=(0,f.Z)(M,[["render",m]]);var b=w},5445:function(e,t,s){s.r(t),s.d(t,{default:function(){return ue}});var a=s(3396);const i={class:"MoricUserList"},n={class:"bottom"},r={class:"content"},o=["index"];function c(e,t,s,c,l,u){const g=(0,a.up)("MoricAppNavation"),m=(0,a.up)("MoricSearchInput"),d=(0,a.up)("MoricGroupItem"),v=(0,a.up)("MoricUserListItem"),p=(0,a.Q2)("animate");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a.Wm)(g,{name:c.homeMsg.name,msg:c.homeMsg.msg},null,8,["name","msg"]),(0,a._)("div",n,[(0,a.Wm)(m),(0,a._)("ul",r,[(0,a._)("li",null,[(0,a.Wm)(d)]),c.userListArray.length?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:0},(0,a.Ko)(c.userListArray,((e,t)=>(0,a.wy)(((0,a.wg)(),(0,a.iD)("li",{key:e.user_id,index:t},[(0,a.Wm)(v,{item:e},null,8,["item"])],8,o)),[[p]]))),128)):(0,a.kq)("",!0)])])])}var l=s(2176),u=s(7139),g=s(9242);const m={class:"avatar loading"},d=["src"],v={key:1,class:"defaultAvatar"},p={class:"establishChat"},h={class:"establishChat_left"},_={class:"userName"},M={class:"msgData"},f={class:"establishChat_right"},w={class:"msgDeta"},b={class:"unread"},C={key:0,class:"unreadData"};function L(e,t,s,i,n,r){const o=(0,a.Q2)("listLoding");return(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",{class:(0,u.C_)(["MoricUserListItem",i.active]),onTouchstartPassive:t[0]||(t[0]=(0,g.iM)(((...e)=>i.toggleClass&&i.toggleClass(...e)),["stop"])),onTouchendPassive:t[1]||(t[1]=(0,g.iM)(((...e)=>i.toggleClass&&i.toggleClass(...e)),["stop"])),onClick:t[2]||(t[2]=(0,g.iM)(((...e)=>i.jump&&i.jump(...e)),["stop"]))},[(0,a._)("div",m,[i.imgNode.data?((0,a.wg)(),(0,a.iD)("img",{key:0,src:i.imgNode.data,alt:"头像",class:"avatarImage"},null,8,d)):((0,a.wg)(),(0,a.iD)("div",v,"  "))]),(0,a._)("div",p,[(0,a._)("div",h,[(0,a._)("div",_,(0,u.zw)(i.user.name),1),(0,a._)("div",M,(0,u.zw)(i.user.lastMsg),1)]),(0,a._)("div",f,[(0,a._)("div",w,(0,u.zw)(i.user.timing),1),(0,a._)("div",b,[i.user.unreadMessage?((0,a.wg)(),(0,a.iD)("i",C,(0,u.zw)(i.user.unreadMessage),1)):(0,a.kq)("",!0)])])])],34)),[[o]])}s(7658);var y=s(4870),D=s(2483),I=s(3044),k=s(1917),A={props:["item"],setup(e){const t=(0,k.z)();let{item:s}=e;const a=(0,D.tv)();let i=(0,y.qj)({data:null}),n=(0,y.iH)({active:!1});const r=(0,I.i)();s.user_id&&r.requestImage(s.user_id,s.avatar_type).then((e=>{i.data=e}),(e=>{console.log(e)}));let o=(0,y.qj)({name:null,lastMsg:null,timing:null,unreadMessage:0});function c(){n.value=!0}function l(){a.push({name:"MoricChatInterface",query:{chat_name:o.name,chat_id:s.user_id}})}return s&&(o.name=s.username,o.lastMsg=s.lastMsg,o.timing=s.timing),Promise.resolve(t.createChatList(s.user_id)).then((()=>{const e=t.getChatRecordLastMessage(s.user_id);e&&(o.lastMsg=e.messageData,o.timing=e.timeing)})),PubSub.subscribe(`${s.user_id}`,((e,t)=>{o.unreadMessage++,o.lastMsg=t.messageData,o.timing=t.timeing})),{imgNode:i,user:o,active:n,jump:l,toggleClass:c}}},P=s(89);const U=(0,P.Z)(A,[["render",L],["__scopeId","data-v-64928705"]]);var j=U;const z=e=>((0,a.dD)("data-v-e82406da"),e=e(),(0,a.Cn)(),e),q={class:"MoricSearchInput"},$=z((()=>(0,a._)("input",{type:"text",title:"search",placeholder:" 好友"},null,-1))),N=[$];function x(e,t,s,i,n,r){return(0,a.wg)(),(0,a.iD)("div",q,N)}var Z={name:"MoricSearchInput"};const T=(0,P.Z)(Z,[["render",x],["__scopeId","data-v-e82406da"]]);var R=T;const S=e=>((0,a.dD)("data-v-4be94882"),e=e(),(0,a.Cn)(),e),H=S((()=>(0,a._)("div",{class:"avatar"},"  ",-1))),W={class:"establishChat"},G={class:"establishChat_left"},Q={class:"userName"},B={class:"msgData"},O={class:"establishChat_right"},F={class:"msgDeta"},K={class:"unread"},Y={key:0,class:"unreadData"};function E(e,t,s,i,n,r){return(0,a.wg)(),(0,a.iD)("div",{class:(0,u.C_)(["MoricUserListItem",i.active]),onTouchstartPassive:t[0]||(t[0]=(0,g.iM)(((...e)=>i.toggleClass&&i.toggleClass(...e)),["stop"])),onTouchendPassive:t[1]||(t[1]=(0,g.iM)(((...e)=>i.toggleClass&&i.toggleClass(...e)),["stop"])),onClick:t[2]||(t[2]=(0,g.iM)(((...e)=>i.jump&&i.jump(...e)),["stop"]))},[H,(0,a._)("div",W,[(0,a._)("div",G,[(0,a._)("div",Q,(0,u.zw)(i.user.username),1),(0,a._)("div",B,(0,u.zw)(i.user.lastMsg),1)]),(0,a._)("div",O,[(0,a._)("div",F,(0,u.zw)(i.user.timing),1),(0,a._)("div",K,[i.unread?((0,a.wg)(),(0,a.iD)("i",Y,(0,u.zw)(i.unread),1)):(0,a.kq)("",!0)])])])],34)}var J=s(3017),V=s.n(J),X=s(881),ee={setup(){const e=(0,k.z)();let t=(0,y.iH)({active:!1});const s=(0,X.x)();let a=(0,y.qj)(s.getGroup(9e4)),i=(0,y.iH)(0);function n(){t.value=!0}const r=(0,D.tv)();function o(){r.push({name:"MoricChatInterface",query:{chat_name:a.username,chat_id:a.user_id}})}return Promise.resolve(e.createChatList(a.user_id)).then((()=>{const t=e.getChatRecordLastMessage(a.user_id);t&&(a.lastMsg=t.messageData,a.timing=t.timeing)})),V().subscribe(`${a.user_id}`,((e,t)=>{i.value++,a.lastMsg=t.messageData,a.timing=t.timeing})),V().subscribe(`${a.user_id}readed`,(()=>{i.value=0})),{unread:i,user:a,active:t,toggleClass:n,jump:o}}};const te=(0,P.Z)(ee,[["render",E],["__scopeId","data-v-4be94882"]]);var se=te;const ae=50;var ie={async mounted(e){let t=Number(e.getAttribute("index"))+1;t%2==0?await ne(e):await re(e)}};async function ne(e){await e.animate([{opacity:0,transform:`translate(-${ae}px,${ae}px)`},{opacity:1,transform:"translate(0,0)"}],{duration:500,easing:"linear",fill:"both"}).finished}async function re(e){await e.animate([{opacity:0,transform:`translate(${ae}px,${ae}px)`},{opacity:1,transform:"translate(0,0)"}],{duration:500,easing:"linear",fill:"both"}).finished}var oe=s(4239),ce={name:"MoricUserList",components:{MoricAppNavation:l.Z,MoricUserListItem:j,MoricSearchInput:R,MoricGroupItem:se},setup(){let e=(0,y.qj)({name:"消息",msg:{name:"MoricLogin",path:"/"},mySelfLoaded:!1});const t=(0,oe.A)(),s=(0,a.Fl)((()=>t.userListArray));return{homeMsg:e,userListArray:s}},directives:{animate:ie}};const le=(0,P.Z)(ce,[["render",c]]);var ue=le}}]);
//# sourceMappingURL=445.7419eba6.js.map